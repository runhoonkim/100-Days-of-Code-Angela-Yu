from tkinter import *
from tkinter import messagebox
import pandas as pd
import random

BACKGROUND_COLOR = "#B1DDC6"
FONT_NAME = "Arial"
FLIP_DELAY_MS = 3000

# ------------------------ DATA SETUP ------------------------ #
try:
    data = pd.read_csv("words_to_learn.csv")
except FileNotFoundError:
    data = pd.read_csv("data/french_words.csv")

guess_lang, ans_lang = data.columns[:2]

words = dict(zip(data[guess_lang], data[ans_lang]))

# ------------------------ STATE ------------------------ #
current_word = None          # front word currently shown
is_front = True              # whether the card is currently showing the front
flip_job = None              # id returned by window.after(...)
# ------------------------ FUNCTIONS ------------------------ #
def schedule_flip():
    """Ensure there is at most one pending flip timer."""
    global flip_job
    if flip_job is not None:
        window.after_cancel(flip_job)
    flip_job = window.after(FLIP_DELAY_MS, flip_card)

def show_new_card():
    global current_word, is_front

    if not words:
        messagebox.showinfo(title="Success", message=f"No more words left. Great work!")
        return

    current_word = random.choice(list(words))
    is_front = True

    canvas.itemconfig(card, image=card_front)
    canvas.itemconfig(title, text=guess_lang, fill="black")
    canvas.itemconfig(word, text=current_word, fill="black")

    schedule_flip()

def flip_card():
    global is_front, flip_job

    flip_job = None

    if current_word is None or not is_front:
        return  # nothing to do or already flipped

    is_front = False
    canvas.itemconfig(card, image=card_back)
    canvas.itemconfig(title, text=ans_lang, fill="white")
    canvas.itemconfig(word, text=words[current_word], fill="white")

def mark_known():
    """Remove the current word from the pool and go to the next."""
    if current_word is not None and current_word in words:
        del words[current_word]
    show_new_card()

def mark_unknown():
    """Keep the word and go to the next."""
    show_new_card()

# ------------------------ UI SETUP ------------------------ #
window = Tk()
window.title("Flashy")
window.config(padx=50, pady=50, bg=BACKGROUND_COLOR)

# Load images
card_front = PhotoImage(file="images/card_front.png")
card_back = PhotoImage(file="images/card_back.png")
right = PhotoImage(file="images/right.png")
wrong = PhotoImage(file="images/wrong.png")

# Set up canvas with image and text
canvas = Canvas(window, width=800, height=576, bg=BACKGROUND_COLOR, highlightthickness=0)
card = canvas.create_image(400, 300, image=card_front)
title = canvas.create_text(400, 150, text="", font=(FONT_NAME, 40, "italic"))
word = canvas.create_text(400, 263, text="", font=(FONT_NAME, 60, "bold"))
canvas.grid(row=0, column=0, columnspan=2)

# Buttons
right_button = Button(image=right, highlightthickness=0, highlightbackground=BACKGROUND_COLOR, command=mark_known)
wrong_button = Button(image=wrong, highlightthickness=0, highlightbackground=BACKGROUND_COLOR, command=mark_unknown)
right_button.grid(row=1, column=1)
wrong_button.grid(row=1, column=0)

show_new_card()

window.mainloop()

words = {fr:[en] for fr, en in words.items()}
df = pd.DataFrame(words)
df_transposed = df.transpose()
df_transposed = df_transposed.iloc[1:]
df_transposed.to_csv("data/words_to_learn.csv")

