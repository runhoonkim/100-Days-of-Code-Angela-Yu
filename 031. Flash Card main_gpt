import tkinter as tk
from tkinter import messagebox
import pandas as pd
import random

BACKGROUND_COLOR = "#B1DDC6"
FONT_NAME = "Arial"
FLIP_DELAY_MS = 3000

# ------------------------ DATA SETUP ------------------------ #
data = pd.read_csv("data/french_words.csv")

guess_lang, ans_lang = data.columns[:2]
words = dict(zip(data[guess_lang], data[ans_lang]))  # {front: back}

# ------------------------ STATE ------------------------ #
current_word = None          # front word currently shown
is_front = True              # whether the card is currently showing the front
flip_job = None              # id returned by window.after(...)

# ------------------------ FUNCTIONS ------------------------ #
def schedule_flip():
    """Ensure there is at most one pending flip timer."""
    global flip_job
    if flip_job is not None:
        window.after_cancel(flip_job)
    flip_job = window.after(FLIP_DELAY_MS, flip_card)

def show_new_card():
    """Pick a new word and show the front side."""
    global current_word, is_front

    if not words:
        messagebox.showinfo(title="Success", message="No more words left. Great work!")
        return

    current_word = random.choice(list(words))  # list(dict) yields keys
    is_front = True

    canvas.itemconfig(card_image, image=card_front)
    canvas.itemconfig(title_text, text=guess_lang)
    canvas.itemconfig(word_text, text=current_word)

    schedule_flip()

def flip_card():
    """Show the back (answer) for the current word."""
    global is_front, flip_job

    flip_job = None  # this callback just fired

    if current_word is None or not is_front:
        return  # nothing to do or already flipped

    is_front = False
    canvas.itemconfig(card_image, image=card_back)
    canvas.itemconfig(title_text, text=ans_lang)
    canvas.itemconfig(word_text, text=words[current_word])

def mark_known():
    """Remove the current word from the pool and go to the next."""
    if current_word is not None and current_word in words:
        del words[current_word]
    show_new_card()

def mark_unknown():
    """Keep the word and go to the next."""
    show_new_card()

# ------------------------ UI SETUP ------------------------ #
window = tk.Tk()
window.title("Flashy")
window.config(padx=50, pady=50, bg=BACKGROUND_COLOR)

card_front = tk.PhotoImage(file="images/card_front.png")
card_back = tk.PhotoImage(file="images/card_back.png")
right_img = tk.PhotoImage(file="images/right.png")
wrong_img = tk.PhotoImage(file="images/wrong.png")

canvas = tk.Canvas(window, width=800, height=576, bg=BACKGROUND_COLOR, highlightthickness=0)
card_image = canvas.create_image(400, 300, image=card_front)
title_text = canvas.create_text(400, 150, text="", font=(FONT_NAME, 40, "italic"))
word_text = canvas.create_text(400, 263, text="", font=(FONT_NAME, 60, "bold"))
canvas.grid(row=0, column=0, columnspan=2)

wrong_button = tk.Button(image=wrong_img, highlightthickness=0, bg=BACKGROUND_COLOR, command=mark_unknown)
right_button = tk.Button(image=right_img, highlightthickness=0, bg=BACKGROUND_COLOR, command=mark_known)
wrong_button.grid(row=1, column=0)
right_button.grid(row=1, column=1)

# Start the game with the first card
show_new_card()

window.mainloop()
